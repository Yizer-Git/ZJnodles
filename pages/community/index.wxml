<view class="ds-page community-page">
  <view class="profile-card ds-card ds-card--accent">
    <view class="profile-info">
      <image class="avatar" mode="aspectFill" src="{{profile && profile.avatar ? profile.avatar : '/assets/avatar-placeholder.png'}}"></image>
      <view class="profile-meta">
        <text class="nickname">{{profile && profile.nickname ? profile.nickname : 'æ¸¸å®¢'}}</text>
        <text class="level">LV{{profile && profile.level ? profile.level : 0}} {{profile && profile.levelName ? profile.levelName : 'ä½“éªŒä¼šå‘˜'}}</text>
      </view>
    </view>
    <view class="profile-stats">
      <view class="stat">
        <text class="stat-number">{{profile && profile.points ? profile.points : 0}}</text>
        <text class="stat-label">ç§¯åˆ†</text>
      </view>
      <view class="stat">
        <text class="stat-number">{{profile && profile.growthValue ? profile.growthValue : 0}}</text>
        <text class="stat-label">æˆé•¿å€¼</text>
      </view>
      <view class="stat">
        <text class="stat-number">{{profile && profile.couponCount ? profile.couponCount : 0}}</text>
        <text class="stat-label">ä¼˜æƒ åˆ¸</text>
      </view>
    </view>
    <button class="checkin-btn pill-btn pill-btn--ghost" bindtap="handleCheckIn">ç­¾åˆ°é¢†ç§¯åˆ†</button>
  </view>

  <view class="ds-section">
    <view class="ds-section__header">
      <text class="ds-title">ä»»åŠ¡ä¸­å¿ƒ</text>
      <text class="ds-subtitle">å®Œæˆä»»åŠ¡æå‡ç­‰çº§æƒç›Š</text>
    </view>
    <view wx:if="{{loading}}" class="task-skeleton">
      <block wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="task-card ds-card ds-shimmer"></view>
      </block>
    </view>
    <block wx:else>
      <block wx:for="{{tasks}}" wx:key="id">
        <view class="task-card ds-card" bindtap="viewTask" data-id="{{item.id}}">
          <view class="task-info">
            <text class="task-title">{{item.name}}</text>
            <text class="task-desc">{{item.description}}</text>
          </view>
          <view class="task-meta">
            <text class="task-points">+{{item.rewardPoints}}ç§¯åˆ†</text>
            <text class="task-status">{{item.statusLabel}}</text>
          </view>
        </view>
      </block>
    </block>
  </view>

  <view class="ds-section">
    <view class="ds-section__header">
      <text class="ds-title">ç¤¾åŒºåŠ¨æ€</text>
      <text class="ds-subtitle">ä¼šå‘˜ç²¾é€‰Â·UGCå†…å®¹</text>
    </view>
    <block wx:if="{{feeds.length === 0}}">
      <view class="empty ds-card ds-card--frosted">æš‚æ— åŠ¨æ€ï¼Œæ¬¢è¿å‘å¸ƒä½ çš„æ•…äº‹</view>
    </block>
    <block wx:else>
      <block wx:for="{{feeds}}" wx:key="id">
        <view class="feed-card ds-card ds-card--frosted">
          <view class="feed-header">
            <image class="feed-avatar" mode="aspectFill" src="{{item.authorAvatar}}"></image>
            <view>
              <text class="feed-author">{{item.authorName}}</text>
              <text class="feed-time">{{item.publishTimeText}}</text>
            </view>
          </view>
          <text class="feed-content">{{item.content}}</text>
          <scroll-view scroll-x class="feed-images">
            <block wx:for="{{item.images}}" wx:key="*this">
              <image class="feed-image" mode="aspectFill" src="{{item}}"></image>
            </block>
          </scroll-view>
          <view class="feed-actions">
            <text>ğŸ‘ {{item.likes}}</text>
            <text>ğŸ’¬ {{item.comments}}</text>
            <text>ğŸ” {{item.shares}}</text>
          </view>
        </view>
      </block>
    </block>
  </view>

  <view class="ds-section">
    <view class="ds-section__header">
      <text class="ds-title">ç§¯åˆ†å•†åŸ</text>
      <text class="ds-subtitle">å…‘æ¢å‘¨è¾¹ä¸ä½“éªŒ</text>
    </view>
    <scroll-view scroll-x class="mall-scroll">
      <block wx:for="{{mall}}" wx:key="id">
        <view class="mall-item ds-card">
          <image class="mall-cover" mode="aspectFill" src="{{item.cover}}"></image>
          <text class="mall-title">{{item.title}}</text>
          <text class="mall-points">{{item.points}}ç§¯åˆ†</text>
          <button class="pill-btn pill-btn--primary" size="mini" bindtap="redeemReward" data-id="{{item.id}}">ç«‹å³å…‘æ¢</button>
        </view>
      </block>
    </scroll-view>
  </view>

  <view wx:if="{{showTaskSheet}}" class="task-sheet">
    <view class="sheet-mask" bindtap="closeTaskSheet"></view>
    <view class="sheet-content ds-card ds-card--frosted">
      <text class="sheet-title">{{activeTask && activeTask.name ? activeTask.name : ''}}</text>
      <text class="sheet-desc">{{activeTask && activeTask.description ? activeTask.description : ''}}</text>
      <view class="sheet-meta">
        <text>å¥–åŠ±ï¼š{{activeTask && activeTask.rewardPoints ? activeTask.rewardPoints : 0}}ç§¯åˆ†</text>
        <text>æˆªæ­¢ï¼š{{activeTask && activeTask.deadlineText ? activeTask.deadlineText : ''}}</text>
      </view>
      <button class="sheet-confirm pill-btn pill-btn--primary" bindtap="acceptTask">ç«‹å³å‚ä¸</button>
    </view>
  </view>
</view>

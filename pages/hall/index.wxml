<view class="page">
  <image class="page__bg" mode="aspectFill" src="{{backgrounds.generic}}"></image>
  <view class="page__content">
  <view class="section-header">
    <text class="section-title">ä¼ ä¹ å¯¼è§ˆ</text>
    <text class="section-subtitle">å¿«é€Ÿè¿›å…¥é¦†å†…äº®ç‚¹</text>
  </view>
  <view class="heritage-nav-grid">
    <block wx:for="{{navCards}}" wx:key="id">
      <view
        class="heritage-nav-item surface-card surface-card--frosted"
        data-id="{{item.id}}"
        bindtap="handleNavTap"
      >
        <image class="heritage-nav-icon" mode="aspectFit" src="{{item.icon}}"></image>
        <text class="heritage-nav-title">{{item.title}}</text>
        <text class="heritage-nav-desc">{{item.desc}}</text>
      </view>
    </block>
  </view>

  <view class="section-header">
    <text class="section-title">é¦†å†…ç„¦ç‚¹</text>
    <text class="section-subtitle">çœŸå®åœºæ™¯ Â· æ•°æ®çœ‹æ¿ Â· åŒ å¿ƒç²¾é€‰</text>
  </view>
  <view class="heritage-focus-list">
    <block wx:for="{{heritageFocusCards}}" wx:key="id">
      <view
        class="heritage-focus-card surface-card surface-card--frosted"
        data-id="{{item.id}}"
        bindtap="handleFocusCardTap"
      >
        <view class="heritage-focus-head">
          <text class="heritage-focus-title">{{item.title}}</text>
          <text class="heritage-focus-desc">{{item.desc}}</text>
        </view>
        <view class="heritage-focus-highlights" wx:if="{{item.highlights && item.highlights.length}}">
          <block wx:for="{{item.highlights}}" wx:key="*this">
            <view class="heritage-focus-chip">{{item}}</view>
          </block>
        </view>
        <button
          wx:if="{{item.cta && item.cta.text}}"
          class="pill-btn pill-btn--accent heritage-focus-cta"
          data-id="{{item.id}}"
          catchtap="handleFocusCardTap"
        >
          {{item.cta.text}}
        </button>
      </view>
    </block>
  </view>

  <view class="heritage-divider heritage-divider--totem" style="background-image: url({{hallPatterns.circularTotem}});"></view>

  <view class="section-header">
    <text class="section-title">åŒ å¿ƒæ…¢è¯»</text>
    <text class="section-subtitle">èŒ¶å™æ•…äº‹ Â· æ²‰æµ¸å¤œè¯»</text>
  </view>
  <scroll-view class="heritage-story-scroll" scroll-x>
    <block wx:for="{{storyPanels}}" wx:key="id">
      <view
        class="heritage-story-card surface-card surface-card--frosted"
        data-id="{{item.id}}"
        bindtap="handleStoryTap"
      >
        <image class="heritage-story-icon" mode="aspectFit" src="{{item.icon}}"></image>
        <text class="heritage-story-title">{{item.title}}</text>
        <text class="heritage-story-desc">{{item.desc}}</text>
      </view>
    </block>
  </scroll-view>

  <view class="heritage-divider heritage-divider--frame" style="background-image: url({{hallPatterns.imperialRoundFrame}});"></view>

  <view class="section-header">
    <text class="section-title">éé—èµ„è®¯</text>
    <text class="section-subtitle">åŒ å¿ƒæ•…äº‹ Â· æ´»åŠ¨é€Ÿé€’</text>
  </view>
  <view class="sub-tabs" wx:if="{{feedTabs.length > 1}}">
    <block wx:for="{{feedTabs}}" wx:key="*this">
      <view
        class="sub-tab-item {{activeFeedTab === item ? 'active' : ''}}"
        data-tab="{{item}}"
        bindtap="handleFeedTabChange"
      >
        {{item}}
      </view>
    </block>
  </view>
  <block wx:if="{{displayFeeds.length === 0}}">
    <view class="feed-empty surface-card surface-card--frosted">æš‚æ— èµ„è®¯ï¼Œæ•¬è¯·æœŸå¾…</view>
  </block>
  <block wx:else>
    <block wx:for="{{displayFeeds}}" wx:key="id">
      <view class="feed-card-large surface-card">
        <image
          class="feed-cover-lg"
          mode="aspectFill"
          src="{{item.cover ? item.cover : '/assets/images/promo-images/0.png'}}"
        ></image>
        <view class="feed-meta-content">
          <view class="feed-meta-top">
            <view class="feed-tag feed-tag-new" wx:if="{{item.tag || item.category}}">
              {{item.tag ? item.tag : item.category}}
            </view>
            <text class="feed-time">{{item.publishTimeText ? item.publishTimeText : 'åˆšåˆšæ›´æ–°'}}</text>
          </view>
          <text class="feed-title-lg">{{item.title}}</text>
          <text class="feed-subtitle-lg" wx:if="{{item.summary}}">{{item.summary}}</text>
          <view class="feed-actions-lg">
            <view class="feed-author-meta">
              <image
                class="feed-avatar-sm"
                mode="aspectFill"
                src="{{item.authorAvatar ? item.authorAvatar : '/assets/avatar-placeholder.jpg'}}"
              ></image>
              <view class="feed-author-text">
                <text class="feed-author">{{item.authorName ? item.authorName : 'é¦†å†…é¡¾é—®'}}</text>
                <text class="feed-author-role">
                  {{item.authorRole ? item.authorRole : 'éé—è®²è¿°è€…'}}
                </text>
              </view>
            </view>
            <view class="feed-stats">
              <view class="feed-stat-item">
                <text class="feed-stat-icon">ğŸ‘</text>
                <text class="feed-stat-value">{{item.views ? item.views : 0}}</text>
              </view>
              <view class="feed-stat-item">
                <text class="feed-stat-icon">ğŸ‘</text>
                <text class="feed-stat-value">{{item.likes ? item.likes : 0}}</text>
              </view>
              <view class="feed-stat-item">
                <text class="feed-stat-icon">ğŸ’¬</text>
                <text class="feed-stat-value">{{item.comments ? item.comments : 0}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </block>
  </block>

  <view class="section-header">
    <text class="section-title">æ²‰æµ¸å¼ä½“éªŒ</text>
    <text class="section-subtitle">3Då·¥è‰ºæµç¨‹ã€äº’åŠ¨æœºä½ã€å¯¼è§ˆè·¯çº¿</text>
  </view>

  <view wx:if="{{loading}}" class="skeleton">
    <block wx:for="{{[1,2,3]}}" wx:key="*this">
      <view class="skeleton-card surface-card shimmer"></view>
    </block>
  </view>

  <scroll-view wx:else scroll-x class="scene-scroll">
    <block wx:for="{{scenes}}" wx:key="id">
      <view class="scene-card surface-card surface-card--frosted" bindtap="handleSceneTap" data-id="{{item.id}}">
        <image class="scene-cover" mode="aspectFill" src="{{item.cover}}"></image>
        <view class="scene-info">
          <text class="scene-title">{{item.title}}</text>
          <text class="scene-desc">{{item.description}}</text>
        </view>
      </view>
    </block>
  </scroll-view>

  <view class="heritage-divider heritage-divider--lattice" style="background-image: url({{hallPatterns.displayShelf}});"></view>

  <view class="section-header">
    <text class="section-title">æ¥é¦†æœåŠ¡</text>
    <text class="section-subtitle">é¢„çº¦ç­‰å€™ Â· ç¤¼é‡æŒ‡å¼•</text>
  </view>
  <view class="heritage-service-grid">
    <block wx:for="{{serviceCards}}" wx:key="id">
      <view
        class="heritage-service-card surface-card surface-card--frosted"
        data-id="{{item.id}}"
        bindtap="handleServiceTap"
      >
        <image class="heritage-service-icon" mode="aspectFit" src="{{item.icon}}"></image>
        <view class="heritage-service-text">
          <text class="heritage-service-title">{{item.title}}</text>
          <text class="heritage-service-desc">{{item.desc}}</text>
        </view>
      </view>
    </block>
  </view>

  <view class="heritage-divider heritage-divider--border" style="background-image: url({{hallPatterns.imperialSquareFrame}});"></view>

  <view class="section-header mission">
    <text class="section-title">é—¯å…³ä»»åŠ¡</text>
    <button class="mission-btn pill-btn pill-btn--primary" bindtap="openMissionDrawer">æŸ¥çœ‹ä»»åŠ¡</button>
  </view>

  <view class="section-header">
    <text class="section-title">å¾½ç« ä¸­å¿ƒ</text>
    <text class="section-subtitle">æ”¶è—ä½ çš„ä¸“å±è£èª‰</text>
  </view>
  <view class="badge-grid heritage-badge-grid">
    <block wx:for="{{badges}}" wx:key="id">
      <view class="badge-card surface-card surface-card--frosted">
        <image class="badge-icon" mode="aspectFit" src="{{item.icon}}"></image>
        <text class="badge-title">{{item.title}}</text>
        <button class="pill-btn pill-btn--ghost" size="mini" bindtap="shareBadge" data-id="{{item.id}}">åˆ†äº«</button>
      </view>
    </block>
  </view>

  <view wx:if="{{activeScene}}" class="scene-dialog">
    <view class="dialog-content surface-card surface-card--frosted">
      <text class="dialog-title">{{activeScene.title}}</text>
      <video class="dialog-video" src="{{activeScene.preview}}" controls></video>
      <text class="dialog-desc">{{activeScene.description}}</text>
      <button class="pill-btn pill-btn--primary" bindtap="closeScenePreview">å…³é—­é¢„è§ˆ</button>
    </view>
  </view>

  <view wx:if="{{showMissionDrawer}}" class="mission-drawer">
    <view class="drawer-mask" bindtap="closeMissionDrawer"></view>
    <view class="drawer-content surface-card surface-card--frosted">
      <view class="drawer-header">
        <text class="drawer-title">ä»»åŠ¡ä¸­å¿ƒ</text>
        <text class="drawer-desc">å®Œæˆä»»åŠ¡å¯å‡çº§å¾½ç« ï¼Œå…‘æ¢ç§¯åˆ†</text>
      </view>
      <scroll-view scroll-y class="drawer-list">
        <block wx:for="{{missions}}" wx:key="id">
          <view class="mission-row surface-card">
            <view class="mission-info">
              <text class="mission-title">{{item.title}}</text>
              <text class="mission-desc">{{item.description}}</text>
            </view>
            <button class="pill-btn pill-btn--primary" size="mini" bindtap="startMission" data-id="{{item.id}}">å»æŒ‘æˆ˜</button>
          </view>
        </block>
      </scroll-view>
    </view>
  </view>
  </view>
</view>

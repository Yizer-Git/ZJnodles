<view class="ds-page home-page">
  <image class="home-page__bg" mode="aspectFill" src="{{backgrounds.generic}}"></image>
  <view class="home-page__content">
  <view class="home-search surface-card surface-card--frosted" bindtap="goSearch">
    <image
      class="search-icon-img"
      mode="aspectFit"
      src="/assets/images/icons/search.svg"
    ></image>
    <text class="search-placeholder">搜“麦香礼盒”或“晾晒工艺”</text>
  </view>

  <view class="home-banner">
    <image class="home-banner__image" mode="widthFix" src="{{backgrounds.core}}"></image>
  </view>

  <view class="ds-section">
    <view class="section-card ds-card story-card">
      <view class="section-card__header">
        <text class="section-card__title">非遗故事集</text>
        <text class="section-card__subtitle">传承人、古法瞬间、乡土风物每日更新</text>
      </view>

      <view class="sub-tabs" wx:if="{{storyTabs.length}}">
        <block wx:for="{{storyTabs}}" wx:key="*this">
          <view
            class="sub-tab-item {{activeStoryTab === item ? 'active' : ''}}"
            data-tab="{{item}}"
            bindtap="handleStoryTabChange"
          >
            {{item}}
          </view>
        </block>
      </view>

      <block wx:if="{{loading && !displayStories.length}}">
        <block wx:for="{{[1,2,3]}}" wx:key="*this">
          <view class="feed-card-large ds-card ds-shimmer skeleton-story"></view>
        </block>
      </block>
      <block wx:else>
        <block wx:for="{{displayStories}}" wx:key="id">
          <view class="feed-card-large ds-card surface-card">
            <image
              class="feed-cover-lg"
              mode="aspectFill"
              src="{{item.cover || 'https://dummyimage.com/640x400/cdeff5/0097a7&text=Heritage'}}"
            ></image>
            <view class="feed-meta-content">
              <view class="feed-meta-top">
                <view class="feed-tag feed-tag-new">{{item.categoryLabel || '非遗'}}</view>
                <view class="feed-views">
                  <image
                    class="feed-stat-icon"
                    mode="aspectFit"
                    src="/assets/images/icons/view.svg"
                  ></image>
                  <text class="feed-views-count">{{item.views || 0}}</text>
                </view>
              </view>
              <text class="feed-title-lg">{{item.title}}</text>
              <text class="feed-subtitle-lg" wx:if="{{item.description}}">{{item.description}}</text>
              <view class="feed-actions-lg">
                <view class="feed-author-meta">
                  <image
                    class="author-avatar"
                    mode="aspectFill"
                    src="{{item.authorAvatar || '/assets/avatar-placeholder.jpg'}}"
                  ></image>
                  <view class="feed-author-text">
                    <text class="author-name">{{item.authorName || '匠人顾问'}}</text>
                    <text class="author-title">{{item.categoryLabel || '非遗故事'}}</text>
                  </view>
                </view>
                <view class="feed-stats">
                  <view class="feed-stat-item">
                    <image
                    class="feed-stat-icon"
                    mode="aspectFit"
                    src="/assets/images/icons/like.svg"
                  ></image>
                    <text>{{item.likes || 0}}</text>
                  </view>
                  <view class="feed-stat-item">
                    <image
                    class="feed-stat-icon"
                    mode="aspectFit"
                    src="/assets/images/icons/feedback.svg"
                  ></image>
                    <text>{{item.comments || 0}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </block>
      </block>
    </view>
  </view>

  <view class="ds-section main-actions">
    <view class="actions-card ds-card">
      <view class="ds-section__header actions-header">
        <text class="ds-title">核心数字服务</text>
        <text class="ds-subtitle">  文旅、溯源、商城一站式入口</text>
      </view>
      <view class="action-grid">
        <view class="action-item" bindtap="goCommunity">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/collection.svg"
          ></image>
          <text class="action-title">社区任务</text>
        </view>
        <view class="action-item" bindtap="goStudy">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/calendar.svg"
          ></image>
          <text class="action-title">研学预约</text>
        </view>
        <view class="action-item" bindtap="goTrace">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/link.svg"
          ></image>
          <text class="action-title">区块链溯源</text>
        </view>
        <view class="action-item" bindtap="goProducts">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/store.svg"
          ></image>
          <text class="action-title">商城精选</text>
        </view>
        <view class="action-item" bindtap="goHeritageStory">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/heritage.svg"
          ></image>
          <text class="action-title">非遗故事</text>
        </view>
        <view class="action-item" bindtap="goCraftProcess">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/time.svg"
          ></image>
          <text class="action-title">制作工艺</text>
        </view>
        <view class="action-item" bindtap="goMasterArchive">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/profile.svg"
          ></image>
          <text class="action-title">传承档案</text>
        </view>
        <view class="action-item" bindtap="goEnterprise">
          <image
            class="action-icon-img"
            mode="aspectFit"
            src="/assets/images/icons/view.svg"
          ></image>
          <text class="action-title">企业合作</text>
        </view>
      </view>
    </view>
  </view>

  <view class="ds-section">
    <view class="section-card ds-card">
      <view class="section-card__header">
        <text class="section-card__title">非遗制作实景</text>
        <text class="section-card__subtitle">视频长廊呈现匠人手势、竹筛、麦香与蒸汽</text>
      </view>
      <scroll-view scroll-x class="gallery-scroll">
        <block wx:if="{{loading && !heritageHighlights.length}}">
          <block wx:for="{{[1,2,3]}}" wx:key="*this">
            <view class="gallery-card ds-card ds-shimmer"></view>
          </block>
        </block>
        <block wx:else>
          <block wx:for="{{heritageHighlights}}" wx:key="id">
            <view class="gallery-card">
              <image
                class="gallery-cover"
                mode="aspectFill"
                src="{{item.cover || 'https://dummyimage.com/320x200/cdeff5/ffffff&text=Heritage'}}"
              ></image>
              <text class="gallery-label">{{item.categoryLabel || '非遗'}}</text>
              <text class="gallery-name">{{item.title}}</text>
            </view>
          </block>
        </block>
      </scroll-view>
    </view>
  </view>

  <view class="ds-section">
    <view class="section-card ds-card">
      <view class="section-card__header">
        <text class="section-card__title">运营看板</text>
        <text class="section-card__subtitle">宣传、直播、研学体验位实时掌控</text>
      </view>
      <block wx:if="{{loading}}">
        <block wx:for="{{[1,2,3]}}" wx:key="*this">
          <view class="operation-card ds-card ds-shimmer"></view>
        </block>
      </block>
      <block wx:else>
        <block wx:for="{{operations}}" wx:key="id">
          <view class="operation-card ds-card ds-motif">
            <view class="operation-head">
              <text class="operation-title">{{item.name}}</text>
              <text class="operation-status {{item.online ? 'online' : 'offline'}}">
                {{item.online ? '在线' : '筹备中'}}
              </text>
          </view>
          <text class="operation-desc">{{item.description || '匠心主题活动上新筹备中'}}</text>
        </view>
      </block>
    </block>
      <button class="card-more-btn ds-pill ds-pill--primary" bindtap="goOps">打开运营后台</button>
    </view>
  </view>

  <view class="ds-section">
    <view class="section-card ds-card">
      <view class="section-card__header">
        <text class="section-card__title">非遗好物精选</text>
        <text class="section-card__subtitle">古法晾晒的味道，加一抹青蓝与暖珊瑚</text>
      </view>
      <scroll-view scroll-x class="recommend-scroll">
        <block wx:if="{{loading}}">
          <block wx:for="{{[1,2,3]}}" wx:key="*this">
            <view class="recommend-card ds-card ds-shimmer"></view>
          </block>
        </block>
        <block wx:else>
          <block wx:for="{{recommendations}}" wx:key="id">
            <view class="recommend-card ds-card ds-motif">
              <image
                class="recommend-cover"
                mode="aspectFill"
                src="{{item.cover || 'https://dummyimage.com/320x320/cdeff5/0097a7&text=%E6%8C%82%E9%9D%A2'}}"
              ></image>
              <view class="recommend-tags">
                <text class="recommend-label">{{item.heritageLabel || '非遗古法'}}</text>
                <text class="recommend-note">{{item.craftNote || '自然晾晒'}}</text>
              </view>
              <text class="recommend-title">{{item.title}}</text>
              <text class="recommend-desc">{{item.description}}</text>
              <text class="recommend-price">{{item.priceText || '¥--'}}</text>
            </view>
          </block>
        </block>
      </scroll-view>
      <button class="card-more-btn ds-pill ds-pill--primary" bindtap="goProducts">逛面里精选</button>
    </view>
  </view>

  <view wx:if="{{showCampaign && campaign}}" class="campaign-overlay">
    <view class="campaign-card ds-card ds-card--frosted ds-motif">
      <text class="campaign-title">{{campaign.title}}</text>
      <text class="campaign-desc">
        {{campaign.description || '报名传承课堂，近距离体验晾晒工序与古法面香。'}}
      </text>
      <button class="campaign-btn ds-pill ds-pill--primary" bindtap="goMasterArchive">预约非遗课堂</button>
      <text class="campaign-close" bindtap="closeCampaign">暂不提醒</text>
    </view>
  </view>

  </view>
</view>

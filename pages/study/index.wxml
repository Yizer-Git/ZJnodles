<view class="page">
  <view class="header surface-card surface-card--frosted">
    <view class="header-text">
      <text class="title">中江非遗研学营</text>
      <text class="subtitle">严选日历排期，线上线下联动</text>
    </view>
    <picker mode="date" value="{{currentDate}}" bindchange="handleDateChange">
      <view class="date-picker surface-chip">
        <text>{{currentDate}}</text>
        <text class="arrow">▼</text>
      </view>
    </picker>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">当日行程</text>
      <text class="section-subtitle">签到、课程、线下体验</text>
    </view>
    <block wx:if="{{loading}}">
      <block wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="session-card surface-card shimmer skeleton"></view>
      </block>
    </block>
    <block wx:elif="{{sessions.length === 0}}">
      <view class="empty surface-card surface-card--frosted">该日期暂无研学活动，欢迎预约其他日期</view>
    </block>
    <block wx:else>
      <block wx:for="{{sessions}}" wx:key="id">
        <view class="session-card surface-card">
          <view class="session-head">
            <text class="session-time">{{item.startTimeText}} - {{item.endTimeText}}</text>
            <text class="session-status">{{item.statusLabel}}</text>
          </view>
          <text class="session-title">{{item.title}}</text>
          <text class="session-desc">{{item.description}}</text>
          <view class="session-meta">
            <text>地点：{{item.location}}</text>
            <text>剩余名额：{{item.remaining}}</text>
          </view>
          <view class="session-actions">
            <button class="pill-btn pill-btn--ghost" size="mini" bindtap="bookSession" data-id="{{item.id}}">预约</button>
            <button class="pill-btn pill-btn--primary" size="mini" type="primary" bindtap="handleCheckIn" data-id="{{item.id}}">签到</button>
          </view>
        </view>
      </block>
    </block>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">紧急通知</text>
      <text class="section-subtitle">天气预警、集合地点、联系方式</text>
    </view>
    <block wx:if="{{notices.length === 0}}">
      <view class="empty surface-card surface-card--frosted">暂无紧急通知</view>
    </block>
    <block wx:else>
      <block wx:for="{{notices}}" wx:key="id">
        <view class="notice-card surface-card">
          <text class="notice-title">{{item.title}}</text>
          <text class="notice-time">{{item.publishTimeText}}</text>
          <text class="notice-content">{{item.content}}</text>
        </view>
      </block>
    </block>
  </view>

  <view wx:if="{{showCertificateToast}}" class="certificate-toast">
    <view class="toast-content surface-card surface-card--frosted">
      <text class="toast-title">电子证书已发送</text>
      <text class="toast-desc">请前往邮箱或积分中心查看，可点击下方按钮下载。</text>
      <button class="toast-btn pill-btn pill-btn--primary" bindtap="downloadCertificate">立即下载</button>
      <text class="toast-close" bindtap="closeCertificateToast">我知道了</text>
    </view>
  </view>
</view>

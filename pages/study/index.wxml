<view class="page">
  <view class="header surface-card surface-card--accent">
    <view class="header-text">
      <view class="header-badge">
        <text class="badge-icon">ğŸŒ¾</text>
        <text class="badge-label">æ–‡æ—…ç ”å­¦</text>
      </view>
      <text class="title">ä¸­æ±Ÿéé—ç ”å­¦è¥</text>
      <text class="subtitle">ä¸¥é€‰æ—¥å†æ’æœŸ Â· å¤æ³•å·¥åŠæ²‰æµ¸ä½“éªŒ</text>
    </view>
    <picker mode="date" value="{{currentDate}}" bindchange="handleDateChange">
      <view class="date-picker surface-chip">
        <text>{{currentDate}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">å½“æ—¥è¡Œç¨‹</text>
      <text class="section-subtitle">ç­¾åˆ°ã€è¯¾ç¨‹ã€çº¿ä¸‹ä½“éªŒ</text>
    </view>
    <block wx:if="{{loading}}">
      <block wx:for="{{[1,2,3]}}" wx:key="*this">
        <view class="session-card surface-card shimmer skeleton"></view>
      </block>
    </block>
    <block wx:elif="{{sessions.length === 0}}">
      <view class="empty surface-card surface-card--frosted">è¯¥æ—¥æœŸæš‚æ— ç ”å­¦æ´»åŠ¨ï¼Œæ¬¢è¿é¢„çº¦å…¶ä»–æ—¥æœŸ</view>
    </block>
    <block wx:else>
      <!-- åªå±•ç¤ºå‰ä¸¤ä¸ªæ—¥ç¨‹ï¼Œé¿å…é¡µé¢è¿‡é•¿ -->
      <block wx:for="{{sessions.slice(0,2)}}" wx:key="id">
        <view class="session-card surface-card">
          <view class="session-head">
            <text class="session-time">{{item.startTimeText}} - {{item.endTimeText}}</text>
            <view class="session-tags">
              <text class="session-chip session-chip--status">{{item.statusLabel}}</text>
              <text class="session-chip session-chip--location">{{item.location}}</text>
            </view>
          </view>
          <!-- æ ‡é¢˜ä¿æŒé†’ç›®ï¼Œå†…å®¹æ¢è¡Œæ˜¾ç¤º -->
          <view class="session-body">
            <text class="session-title">{{item.title}}</text>
            <text class="session-desc">{{item.description}}</text>
          </view>
          <view class="session-meta">
            <text class="meta-label">å‰©ä½™åé¢</text>
            <text class="meta-value">{{item.remaining}}</text>
          </view>
          <view class="session-actions">
            <button class="pill-btn pill-btn--ghost" size="mini" bindtap="bookSession" data-id="{{item.id}}">é¢„çº¦</button>
            <button class="pill-btn pill-btn--primary" size="mini" type="primary" bindtap="handleCheckIn" data-id="{{item.id}}">ç­¾åˆ°</button>
          </view>
        </view>
      </block>
    </block>
  </view>

  <view class="section">
    <view class="section-header">
      <text class="section-title">ç´§æ€¥é€šçŸ¥</text>
      <text class="section-subtitle">å¤©æ°”é¢„è­¦ã€é›†åˆåœ°ç‚¹ã€è”ç³»æ–¹å¼</text>
    </view>
    <block wx:if="{{notices.length === 0}}">
      <view class="empty surface-card surface-card--frosted">æš‚æ— ç´§æ€¥é€šçŸ¥</view>
    </block>
    <block wx:else>
      <block wx:for="{{notices}}" wx:key="id">
        <view class="notice-card surface-card surface-card--frosted">
          <view class="notice-head">
            <text class="notice-title">{{item.title}}</text>
            <text class="notice-time">{{item.publishTimeText}}</text>
          </view>
          <text class="notice-content">{{item.content}}</text>
        </view>
      </block>
    </block>
  </view>

  <view wx:if="{{showCertificateToast}}" class="certificate-toast">
    <view class="toast-content surface-card surface-card--frosted">
      <text class="toast-title">ç”µå­è¯ä¹¦å·²å‘é€</text>
      <text class="toast-desc">è¯·å‰å¾€é‚®ç®±æˆ–ç§¯åˆ†ä¸­å¿ƒæŸ¥çœ‹ï¼Œå¯ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ä¸‹è½½ã€‚</text>
      <button class="toast-btn pill-btn pill-btn--primary" bindtap="downloadCertificate">ç«‹å³ä¸‹è½½</button>
      <text class="toast-close" bindtap="closeCertificateToast">æˆ‘çŸ¥é“äº†</text>
    </view>
  </view>
</view>
